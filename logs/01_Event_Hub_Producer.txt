Collecting newsapi-python
  Downloading newsapi_python-0.2.7-py2.py3-none-any.whl.metadata (1.2 kB)
Requirement already satisfied: requests in /databricks/python3/lib/python3.12/site-packages (2.32.2)
Requirement already satisfied: azure-eventhub in /local_disk0/.ephemeral_nfs/cluster_libraries/python/lib/python3.12/site-packages (5.11.4)
Requirement already satisfied: websocket-client in /local_disk0/.ephemeral_nfs/cluster_libraries/python/lib/python3.12/site-packages (1.8.0)
Requirement already satisfied: charset-normalizer<4,>=2 in /databricks/python3/lib/python3.12/site-packages (from requests) (2.0.4)
Requirement already satisfied: idna<4,>=2.5 in /databricks/python3/lib/python3.12/site-packages (from requests) (3.7)
Requirement already satisfied: urllib3<3,>=1.21.1 in /databricks/python3/lib/python3.12/site-packages (from requests) (1.26.16)
Requirement already satisfied: certifi>=2017.4.17 in /databricks/python3/lib/python3.12/site-packages (from requests) (2024.6.2)
Requirement already satisfied: azure-core<2.0.0,>=1.14.0 in /databricks/python3/lib/python3.12/site-packages (from azure-eventhub) (1.31.0)
Requirement already satisfied: typing-extensions>=4.0.1 in /databricks/python3/lib/python3.12/site-packages (from azure-eventhub) (4.11.0)
Requirement already satisfied: six>=1.11.0 in /usr/lib/python3/dist-packages (from azure-core<2.0.0,>=1.14.0->azure-eventhub) (1.16.0)
Downloading newsapi_python-0.2.7-py2.py3-none-any.whl (7.9 kB)
Installing collected packages: newsapi-python
Successfully installed newsapi-python-0.2.7
Note: you may need to restart the kernel using %restart_python or dbutils.library.restartPython() to use updated packages.
ğŸ”§ Applying SSL compatibility fix...
âš ï¸ SSL fix warning: module 'ssl' has no attribute 'wrap_socket'
âœ… Libraries imported successfully
ğŸ” Connection string format: Endpoint=sb://eh-stock-sentiment-2025.servicebus.w...
âœ… Added EntityPath: stock-data-hub
âœ… All credentials retrieved from Key Vault
âœ… Event Hub connection string configured with EntityPath: stock-data-hub
âœ… Configuration complete
ğŸ—ï¸ Setting up database schema with ALL consistent data types...
ğŸ“ Current catalog: databricks_stock_sentiment_canada
âœ… Schema databricks_stock_sentiment_canada.bronze created/verified
ğŸ—‘ï¸ Dropped any existing tables
âœ… Table databricks_stock_sentiment_canada.bronze.stock_data created with ALL STRING types
âœ… Table databricks_stock_sentiment_canada.bronze.news_data created with ALL STRING types
ğŸ“‹ Available tables in bronze schema: ['news_data', 'stock_data']
ğŸš€ Starting Data Pipeline...
ğŸ“Š Phase 1: API Data Collection
ğŸ“ˆ Fetching stock data for: AAPL, GOOGL, MSFT, AMZN, META, TSLA
ğŸ”„ Fetching stock data for 6 symbols...
âœ… Retrieved AAPL: $211.18 (Volume: 48,974,591.0)
â³ Waiting 12 seconds for rate limiting...
âœ… Retrieved GOOGL: $185.06 (Volume: 34,014,509.0)
â³ Waiting 12 seconds for rate limiting...
âœ… Retrieved MSFT: $510.05 (Volume: 21,209,666.0)
â³ Waiting 12 seconds for rate limiting...
âœ… Retrieved AMZN: $226.13 (Volume: 37,833,807.0)
â³ Waiting 12 seconds for rate limiting...
âœ… Retrieved META: $704.28 (Volume: 12,779,752.0)
â³ Waiting 12 seconds for rate limiting...
âœ… Retrieved TSLA: $329.65 (Volume: 94,254,993.0)
ğŸ“° Fetching financial news...
ğŸ”„ Fetching news articles for query: 'stock market financial'
âœ… Retrieved 8 news articles

ğŸ“Š Data Collection Summary:
   Stock records: 6
   News records: 8

ğŸ“¡ Phase 2: Streaming to Event Hubs
ğŸ”Œ Trying WebSocket connection...
âœ… Connected to Event Hub using WebSocket
ğŸ“ˆ Streaming 6 stock records...
âœ… Sent 6 stock_price events to Event Hub
ğŸ“° Streaming 8 news records...
âœ… Sent 8 news_sentiment events to Event Hub
âœ… Event Hub connection closed
âœ… Successfully streamed all data to Event Hubs

ğŸ’¾ Phase 3: Backup to Bronze Layer
âœ… Saved 6 stock records to Unity Catalog
âœ… Also backed up stock data to ADLS2
âœ… Saved 8 news records to Unity Catalog
âœ… Also backed up news data to ADLS2

ğŸ‰ Pipeline Complete!
âœ… Processed: 6 stocks, 8 news articles
ğŸ“¡ Data streamed to Event Hubs for real-time processing
ğŸ’¾ Data backed up to Bronze layer for reliability

ğŸ” Bronze Layer Verification:
   Total stock records: 6
   Total news records: 8

ğŸ“Š Recent Stock Data:
+------+-----------+----------+--------------------+----------------+
|symbol|close_price|    volume|      ingestion_time|ingestion_source|
+------+-----------+----------+--------------------+----------------+
|  MSFT|     510.05|21209666.0|2025-07-21T22:10:...|        producer|
| GOOGL|     185.06|34014509.0|2025-07-21T22:10:...|        producer|
|  AMZN|     226.13|37833807.0|2025-07-21T22:10:...|        producer|
|  AAPL|     211.18|48974591.0|2025-07-21T22:10:...|        producer|
|  META|     704.28|12779752.0|2025-07-21T22:10:...|        producer|
+------+-----------+----------+--------------------+----------------+


ğŸ“° Recent News Data:
+-------------------------------------------------------------------------+---------------+--------------------------------+------------------+----------------+
|title                                                                    |sentiment_score|ingestion_time                  |sentiment_category|ingestion_source|
+-------------------------------------------------------------------------+---------------+--------------------------------+------------------+----------------+
|Stock market today: Live updates                                         |0.1            |2025-07-21T22:10:53.101403+00:00|neutral           |producer        |
|Is It Time To Consider Buying Retail Food Group Limited (ASX:RFG)?       |0.2            |2025-07-21T22:10:53.101403+00:00|positive          |producer        |
|Your Photography Skills Are Already Obsolete (You Just Don't Know It Yet)|0.0            |2025-07-21T22:10:53.101403+00:00|neutral           |producer        |
+-------------------------------------------------------------------------+---------------+--------------------------------+------------------+----------------+

ğŸ”„ Event Hub Producer Complete!
ğŸ“‹ Stock Table: databricks_stock_sentiment_canada.bronze.stock_data
ğŸ“‹ News Table: databricks_stock_sentiment_canada.bronze.news_data

â° Execution completed: 2025-07-21 22:11:01